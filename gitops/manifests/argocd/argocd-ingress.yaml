apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: argocd-server
  namespace: argocd
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-staging-dns01

    # Gate it with OIDC (oauth2-proxy -> Keycloak), per our standard ingress-nginx auth-url pattern :contentReference[oaicite:5]{index=5}
#    nginx.ingress.kubernetes.io/auth-url: "https://oauth2-proxy.sso.svc.cluster.local/oauth2/auth"
#    nginx.ingress.kubernetes.io/auth-signin: "https://id.example.com/realms/PRIMARY/protocol/openid-connect/auth?client_id=web-oidc&response_type=code&scope=openid%20profile%20email%20groups&redirect_uri=$scheme://$host/oauth2/callback"
#    nginx.ingress.kubernetes.io/auth-response-headers: "Authorization,X-Auth-Request-Email,X-Auth-Request-User,X-Auth-Request-Groups"
spec:
  ingressClassName: nginx-private
  tls:
  - hosts:
    - argocd.int.blackcircuit.ca
    secretName: argocd-tls
  rules:
  - host: argocd.int.blackcircuit.ca
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: argocd-server
            port:
              number: 80
  tls:
    - hosts:
      - argocd.int.blackcircuit.ca 
      secretName: argocd-tls

