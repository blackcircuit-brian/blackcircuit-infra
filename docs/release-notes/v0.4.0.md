# Black Circuit Kubernetes Platform

## Release Notes -- v0.4.0

Release Date: 2026-02-12

------------------------------------------------------------------------

## Overview

v0.4.0 marks a significant architectural milestone. This release
formalizes the DNS control plane, introduces authenticated dynamic
internal DNS updates, establishes Cloudflare-based public publishing via
tunnel targets, and transitions providers to full sync lifecycle
management.

This version moves the platform from experimental automation to a
production-grade, authority-separated control plane.

------------------------------------------------------------------------

## Major Features

### 1. Dual-Provider DNS Control Plane

Two independent external-dns deployments are now authoritative within
clearly defined boundaries:

-   **external-dns-internal**
    -   RFC2136 provider
    -   TSIG-authenticated updates
    -   Manages `int.blackcircuit.ca`
    -   Policy: `sync`
    -   Owner ID: `internal-1`
-   **external-dns-public**
    -   Cloudflare provider
    -   Annotation-gated publishing
    -   Manages `blackcircuit.ca`
    -   Policy: `sync`
    -   Owner ID: `public-1`

TXT registry isolation prevents cross-provider mutation.

------------------------------------------------------------------------

### 2. RFC2136 Dynamic Internal DNS

Internal DNS now supports:

-   BIND9 authoritative master
-   Port-separated authoritative listener (5335)
-   TSIG (hmac-sha256) authentication
-   Deterministic bootstrap-generated secrets
-   Full create/update/delete lifecycle

Operational guardrails include:

-   Firewall enforcement
-   Writable journal directory
-   Explicit negative-cache awareness

------------------------------------------------------------------------

### 3. Cloudflare Tunnel Publishing Model

Public DNS publishing now:

-   Requires explicit ingress annotation
-   Publishes CNAME records to Cloudflare Tunnel targets
-   Prevents private IP A-record leakage
-   Uses proxy-enabled Cloudflare edge resolution

Publishing is opt-in and controlled.

------------------------------------------------------------------------

### 4. Sync Lifecycle Enforcement

Both DNS providers now operate in `policy=sync` mode.

This enables:

-   Deterministic record reconciliation
-   Automatic deletion of stale records
-   Clean ownership boundaries via TXT registry

------------------------------------------------------------------------

### 5. ApplicationSet-Based Provider Deployment

Providers are now deployed via Argo CD ApplicationSet.

Benefits:

-   Branch-aware targetRevision updates
-   No per-application reference mutation
-   Deterministic promotion model
-   Cleaner bootstrap flow

------------------------------------------------------------------------

### 6. Bootstrap Enhancements

Bootstrap now supports:

-   RFC2136 TSIG generation
-   Kubernetes secret creation for internal DNS
-   Cloudflare token duplication across namespaces
-   ApplicationSet-aware deployment
-   Branch reference updates

Bootstrap inputs remain environment-driven and excluded from Git.

------------------------------------------------------------------------

## Operational Notes

-   Pi-hole negative caching can delay visibility of newly created
    internal records.
-   Authoritative testing for internal DNS should use port 5335.
-   Public publishing requires explicit
    `external-dns.alpha.kubernetes.io/target` annotation.
-   TXT ownership isolation must not be altered post-deployment.

------------------------------------------------------------------------

## Architectural Boundaries Introduced

-   Internal DNS is fully independent of public DNS.
-   Public DNS will not publish records without explicit annotation.
-   `.int.blackcircuit.ca` must not be used on public ingress classes.
-   All DNS changes are Git-driven and reconciled declaratively.

------------------------------------------------------------------------

## Breaking Changes

None.

However:

-   DNS is no longer optional or experimental.
-   Sync mode may remove stale externally managed records previously
    created by external-dns.
-   Manual DNS edits for managed zones will be reverted.

------------------------------------------------------------------------

## Next Roadmap Items

-   step-ca integration for internal PKI
-   Admission policy enforcement for ingress/DNS boundaries
-   Secret encryption via SOPS
-   Cloudflare Tunnel lifecycle automation
-   Policy validation for hostname conventions

------------------------------------------------------------------------

v0.4.0 establishes a stable foundation for secure, declarative
networking and authority separation across internal and public domains.
